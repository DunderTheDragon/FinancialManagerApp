<Window x:Class="FinancialManagerApp.Views.ImportTransactionsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="clr-namespace:FinancialManagerApp.Models"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Import transakcji" Height="700" Width="1200"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize"
        Background="#ECF0F1">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="Przegląd i edycja importowanych transakcji" 
                   FontSize="20" FontWeight="Bold" Foreground="#2C3E50" 
                   Margin="0,0,0,15" HorizontalAlignment="Center"/>

        <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="15" 
                BorderBrush="#D5DBDB" BorderThickness="1">
            <DataGrid x:Name="TransactionsDataGrid"
                      ItemsSource="{Binding ImportedTransactions}"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False" 
                      CanUserDeleteRows="False"
                      Background="Transparent" 
                      BorderThickness="0" 
                      RowHeight="50" 
                      VerticalContentAlignment="Center"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="#ECF0F1"
                      VerticalGridLinesBrush="Transparent"
                      SelectionMode="Extended"
                      HeadersVisibility="Column">

                <DataGrid.Columns>
                    <!-- Data operacji -->
                    <DataGridTextColumn Header="Data" Binding="{Binding Date, StringFormat=\{0:yyyy-MM-dd\}}" 
                                        Width="100" IsReadOnly="True"/>

                    <!-- Typ transakcji -->
                    <DataGridTextColumn Header="Typ" Binding="{Binding TransactionType}" 
                                        Width="150" IsReadOnly="True"/>

                    <!-- Kwota -->
                    <DataGridTextColumn Header="Kwota" Binding="{Binding Amount, StringFormat=\{0:N2\} zł}" 
                                        Width="100" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Amount}" Value="{x:Static sys:Decimal.MinValue}">
                                        <Setter Property="Foreground" Value="#E74C3C"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Nazwa -->
                    <DataGridTextColumn Header="Nazwa" Binding="{Binding Name}" 
                                        Width="200" IsReadOnly="True"/>

                    <!-- Kategoria -->
                    <DataGridTemplateColumn Header="Kategoria" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding DataContext.Categories, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedValue="{Binding CategoryId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Type"
                                          SelectionChanged="CategoryComboBox_SelectionChanged"
                                          Loaded="CategoryComboBox_Loaded"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Subkategoria -->
                    <DataGridTemplateColumn Header="Subkategoria" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox x:Name="SubCategoryComboBox"
                                          SelectedValue="{Binding SubCategoryId}"
                                          SelectedValuePath="Id"
                                          DisplayMemberPath="Name"
                                          SelectionChanged="SubCategoryComboBox_SelectionChanged"
                                          Loaded="SubCategoryComboBox_Loaded"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Checkbox - Ustaw jako regułę -->
                    <DataGridCheckBoxColumn Header="Ustaw jako regułę" 
                                            Binding="{Binding ShouldCreateRule}" 
                                            Width="120"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Przyciski na dole -->
        <UniformGrid Grid.Row="2" Columns="2" Margin="0,15,0,0">
            <Button Content="Anuluj" 
                    Command="{Binding CancelCommand}"
                    Margin="0,0,5,0" 
                    Padding="15,8" 
                    Background="Transparent" 
                    BorderBrush="#BDC3C7" 
                    BorderThickness="1" 
                    Cursor="Hand"
                    FontWeight="SemiBold"/>

            <Button Content="Prześlij" 
                    Command="{Binding SaveTransactionsCommand}"
                    Margin="5,0,0,0" 
                    Padding="15,8" 
                    Background="#1ABC9C" 
                    Foreground="White" 
                    FontWeight="Bold" 
                    BorderThickness="0" 
                    Cursor="Hand">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="4"/>
                    </Style>
                </Button.Resources>
            </Button>
        </UniformGrid>
    </Grid>
</Window>
